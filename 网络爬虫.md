# url 维护模块
url分成几部分
* IP或者域名
* 单纯的路径或者文件的名称
url格式：http://192.168.40.150:8080/docs/linuxdev.html
结构：域名或IP地址，路径，文件名
DNS解析就是把域名解析成ip地址

设计url的数据结构
项目                        字段名称
完整的url                   url
域名                        protocal
资源路径                    path
文件名                      filename
当前url处理状态（0-1--1）    state
当前url深度                 deep
当前资源类型                 filetype

http协议请求页面时候的流程：
1. 输入网址
2. 向DNS发送解析请求
3. DNS返回我们一个对应的IP地址
4. 通过IP地址向资源所在的主机发送请求
5. 资源错存在，主机返回状态200状态，同时thttp数据部分会吧数据部分连起来
6. 本地http客户端（一般是浏览器）接收数据
7. 得到资源

页面抓去流程
1. 得到url
2. url进入抓取队列等待抓取
3. 从队里中得到一个url，然后把url分配给一个下载实例
4. 得到下载器的处理状态（url处理状态需要被改写，得到当前url深度，得到当前资源类型，假如下载成功）
5. 得到当前页面中存在的下一级url列表


url维护操作模块(对外接口)：
1. 添加新的URL
2. 新URL进入抓去队列
3. 从抓取队列中移除一个URL
4. 修改URL库中的某一个URl的值
5. 添加新的URL的列表

日志工具
为什么需要日志工具
1. 方便调试
2. 方便代码维护

日志输出信息设计
1. 日志信息等级 + 日期时间 + 调试信息

日志输出等级设计（5个等级）
* 0：调试【debug】：仅仅用于调试
* 1：普通信息【info】:可以让使用者了解的一些信息
* 2：警告信息【warn】:意味着程序中出现了错误，但是并不严重
* 3：错误信息【error】:意味着程序中发生了严重错误，根据实际情况可选择使程序继续运行或使程序终止
* 4：程序崩溃【crash】：程序无法继续运行了

日志调用接口设计：
SPIDER_LOG(日志等级标记，日志输出信息);
注意，配置文件中的日志输出登记字段和接口中的日志等级标记不是一个概念
日志等级标记，纯粹是一个标记，体现在输出的日志字符串中
配置文件中的日志输出登记字段用来控制那些日志被输出

日志实现流程

接口内部的处理流程：
1. 得到控制日志输出等级的标记，用来控制当前日志是否需要输出
2. 得到调用日志接口的时间
3. 得到日志输出信息并进行日志字符串的拼接
4. 吧日志信息输出到指定输出设备

任务调度模块
1. 可以控制程序按照普通程序模式还是按照守护进程模式进行
2. 可以通过参数提供帮助
3. 提供一个运行框架，可以支持多任务管理
4. 包含程序的主流程

尽可能把可拆分的功能封装成独立函数进行调用


定义主程序框架的处理流程:
1. 程序运行时先处理命令行参数，根据参数跳转到响应分支或调用响应的函数
2. 检测是否按照守护进程模式运行（控制选项从命令行参数中得到）
3. 初始化环境
   1. 读取配置文件，提取配置文件中的参数
   2. 根据守护进程模式的标记将当前进程转变为守护进程
   3. 载入程序模块的动态库

4. 开始程序的主处理流程
   1. 监测种子是否存在，把种子交给URL管理器
   2. 分析种子, 得到种子url的IP地址（DNS解析）
   3. 根据种子URL得到第一个页面
   4. 对页面进行处理（复杂流程，由其他模块实现细节）
   5. 从url管理器中取出一个URL
   6. 启动一个处理任务(先检测是否达到最大任务数量，功能封装在一个独立的函数中)
   7. 监控任务处理数量，如果任务维护池中有空闲任务，那么重复5步骤
   8. 回收资源，准备结束程序

继续分解复杂步骤
1. 对页面进行处理：
   1. 对页面进行解析，提取内部的下级URL
   2. 生成URL列表，把URL列表传给URL管理器
   3. 对页面进行持久化操作

2. 处理任务
   1. 从URL管理器得到一个未处理的URL
   2. 通过调用epoll框架产生一个新任务
   3. 调用页面处理过程（复杂步骤1）
   4. 释放过程中产生的临时资源（socket句柄，文件操作句柄，临时申请的内存等）

其他出乎任